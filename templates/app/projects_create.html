{% extends 'base.html' %}
{% load widget_tweaks %}
{% load static %}
{% block content %}

<div class="box box1">
    <div class="row">
        <div class="col-8 mx-auto">

            <div class="row">
                <div class="col mt-3">
                    <h2 class="text-center">画像を選択してください</h2 class="text-center">
                    <p id="selected_base">path</p>
                </div>
            </div>

            <div class="row">
                <div class="col-4 mb-3">
                    <img src="{% static 'images/projectcreate/base/base01.jpg' %}" class="img-fluid z-depth-4 base"
                        name="wave" alt="">
                </div>
                <div class="col-4 mb-3">
                    <img src="{% static 'images/projectcreate/base/base02.jpg' %}" class="img-fluid z-depth-4 base"
                        name="udnie" alt="">
                </div>
                <div class="col-4 mb-3">
                    <img src="{% static 'images/projectcreate/base/base03.jpg' %}" class="img-fluid z-depth-4 base"
                        name="wreck" alt="">
                </div>
                <div class="col-4 mb-3">
                    <img src="{% static 'images/projectcreate/base/base04.jpg' %}" class="img-fluid z-depth-4 base"
                        name="la_muse" alt="">
                </div>
                <div class="col-4 mb-3">
                    <img src="{% static 'images/projectcreate/base/sen.jpg' %}" class="img-fluid z-depth-4 base"
                        name="scream" alt="">
                </div>
                <div class="col-4 mb-3">
                    <img src="{% static 'images/projectcreate/base/hito.jpg' %}" class="img-fluid z-depth-4 base"
                        name="rain_princess" alt="">
                </div>
            </div>

        </div>
    </div>

</div>
<!--box-->
<div class="box box2">
    <div class="row">
        <div class="col-8 mx-auto">


            <div class="row">
                <div class="col mt-3">
                    <h2 class="text-center">スタイルを選択してください</h2 class="text-center">
                    <p id="style_no">style</p>
                </div>
            </div>

            <div class="row">
                <div class="col-4 mb-3 view overlay">
                    <img src="{% static 'images/projectcreate/style/wave.jpg' %}"
                        class="img-fluid z-depth-4 select_style" name="wave" alt="">
                    <!-- <div class="mask flex-center waves-effect waves-light rgba-black-strong">
                        <p class="white-text">神奈川沖浪裏<br>葛飾北斎</p>

                    </div> -->
                </div>
                <div class="col-4 mb-3 view overlay">
                    <img src="{% static 'images/projectcreate/style/udnie.jpg' %}"
                        class="img-fluid z-depth-4 select_style" name="udnie" alt="">
                    <!-- <div class="mask flex-center waves-effect waves-light rgba-black-strong">
                        <p class="white-text">Udnie</p>
                    </div> -->
                </div>
                <div class="col-4 mb-3 view overlay">
                    <img src="{% static 'images/projectcreate/style/wreck.jpg' %}"
                        class="img-fluid z-depth-4 select_style" name="wreck" alt="">
                    <!-- <div class="mask flex-center waves-effect waves-light rgba-black-strong">
                        <p class="white-text">Wreck</p>
                    </div> -->
                </div>
                <div class="col-4 mb-3 view overlay">
                    <img src="{% static 'images/projectcreate/style/la_muse.jpg' %}"
                        class="img-fluid z-depth-4 select_style" name="la_muse" alt="">
                    <!-- <div class="mask flex-center waves-effect waves-light rgba-black-strong">
                        <p class="white-text">La_mse</p>
                    </div> -->
                </div>
                <div class="col-4 mb-3 view overlay">
                    <img src="{% static 'images/projectcreate/style/scream.jpg' %}"
                        class="img-fluid z-depth-4 select_style" name="scream" alt="">
                    <!-- <div class="mask flex-center waves-effect waves-light rgba-black-strong">
                        <p class="white-text">The Scream<br>Edvard Munch</p>
                    </div> -->
                </div>
                <div class="col-4 mb-3 view overlay">
                    <img src="{% static 'images/projectcreate/style/rain_princess.jpg' %}"
                        class="img-fluid z-depth-4 select_style" name="rain_princess" alt="">
                    <!-- <div class="mask flex-center waves-effect waves-light rgba-black-strong">
                        <p class="white-text">Strong overlay</p>
                    </div> -->
                </div>
            </div>
            <button type="button" id="style_change_btn" class="btn rounded-pill btn-amber"><i
                    class="fas fa-th-list pr-2" aria-hidden="true"></i>スタイル変換</button>
        </div>
    </div>

</div>
<!--box-->
<div class="box box3">
    <div class="row">
        <div class="col-8 mx-auto">
            <div class="row">
                <div class="col mt-3">
                    <h2 class="text-center">AIが生成した絵</h2>
                </div>
            </div>

            <div class="row">
                <div class="col mx-auto">
                    <img src="" id="base_area" class="img-fluid mx-auto d-block" alt="">
                </div>
            </div>
            <div class="row">
                <div class="col">

                    <p id="base">base</p>
                    <p id="style">style</p>
                    <p id="out">out</p>
                </div>
            </div>

            <!-- <div class="row">
                <div class="col mx-auto mt-5 mb-5">
                    <div class="relative mx-auto">
                        <img src="" alt="" width="800px" class="mx-auto d-block" id="base_area">
                    </div>
                </div>
            </div> -->

        </div>
    </div>
</div>
<!--box-->
<div class="box box4">
    <div class="row">
        <div class="col-8 mx-auto">

            <div class="row">
                <div class="col mt-3">
                    <h2 class="text-center">作品にタイトルをつけてください
                    </h2>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    <form class="fm" id="fm2" name="fm_name" action="{% url 'app:projects_create' %}" method="POST"
                        enctype="multipart/form-data">
                        {% csrf_token %}

                        <div class="form-group">
                            <label for="">タイトル</label>
                            {{ form.title|add_class:"form-control" }}
                        </div>
                        <div class="form-group">
                            <label for="">コメント</label>
                            {{ form.comment|add_class:"form-control" }}
                        </div>

                        <div class="form-group">
                            <button class="btn btn-indigo" data-toggle="modal" data-target="#basicExampleModal"><i
                                    class="fas fa-map-marker-alt"></i>位置情報を追加する</button>
                            <p>※写真を撮影した場所を追加するとマップに反映されます</p>
                        </div>

                        <!-- <div class="form-group">
                            <label for="">緯度</label>
                            {{ form.latitude|add_class:"form-control" }}
                        </div>

                        <div class="form-group">
                            <label for="">経度</label>
                            {{ form.longitude|add_class:"form-control" }}
                        </div> -->

                        <!-- hidden field -->
                        {% for hidden in form.hidden_fields %}
                        {{ hidden }}
                        {% endfor %}
                        <button class="btn btn-purple btn-block my-4 waves-effect waves-light"
                            type="submit">プロジェクトを保存する</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="box box5">
    <div class="row">
        <div class="col-8 mx-auto">
            <div class="row">
                <div class="col mt-3">
                    <h2 class="text-center">作品が完成しました！
                    </h2>

                </div>

            </div>

            <div class="row">
                <div class="col mx-auto mt-5 mb-5">
                    <div class="mx-auto">
                        <img src="" alt="" width="800px" class="mx-auto d-block" id="base_area">

                        <img src="{% static 'images/frame/frame.png' %}" class="mx-auto d-block z-depth-4" width="800px"
                            style="cursor: pointer;">
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col mx-auto">
                    <p>
                        プレート
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col text-right">
                    <a href="{% url 'app:users_detail' request.user.id %}" class="btn btn-unique">マイページへ戻る</a>
                </div>

            </div>
        </div>
    </div>
</div>
<!--box-->

<!-- Modal -->
<div class="modal fade" id="basicExampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">撮影場所の検索</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">


                <form class="form-inline">
                    <div class="form-group">
                        <input type="text" id="address" class="form-control form-control-lg" placeholder="住所・施設名">
                    </div>
                    <button class="btn btn-amber" type="button"
                        onclick="attrLatLngFromAddress(document.getElementById('address').value)">検索</button>
                </form>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">キャンセル</button>
                <button type="button" class="btn btn-primary">場所を追加</button>
            </div>
        </div>

    </div>
</div>

{% endblock %}
{% block extrajs %}
<script src="https://cdn.jsdelivr.net/npm/jquery-scrollify@1/jquery.scrollify.min.js"></script>
<script src="{% static 'js/jquery.flipster.min.js' %}" type="text/javascript"></script>

<script>
    $.scrollify({ section: ".box" });
</script>

<script>
    $(document).ready(function () {

        $(".bases").flipster({
            style: 'flat',
            spacing: -0.25,
            scrollwheel: false,
            buttons: true,

        });
    });
</script>

<script>
    // 画像クリックでキャンパスに表示
    $(".base").click(function (event) {
        $('#selected_base').empty();
        $('#selected_base').append($(this).attr("src"));
    });

    // スタイル選択で番号表示
    $(".select_style").click(function (event) {
        $('#style_no').empty();
        $('#style_no').append($(this).attr("name"));
    });
</script>

<script>
    var map = null;
    var maplat;
    var maplng;

    var infowindow = new google.maps.InfoWindow();
    function attrLatLngFromAddress(place) {
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({
            address: place
        }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                var lat = results[0].geometry.location.lat();
                var lng = results[0].geometry.location.lng();

                $('#id_latitude').val('');
                $('#id_longitude').val('');
                //domに追加
                $('#id_latitude').val(lat);
                $('#id_longitude').val(lng);


            } else {
                alert('住所検索に失敗しました');
            }
        });
    }
</script>

<script>

    $(document).ready(function () {

        // スタイル変換押されたらデータを送信
        $("#style_change_btn").click(function () {

            // モーダル表示
            //$('.modal').modal();

            $('#base').empty();
            $('#style').empty();
            $('#out').empty();

            $.ajax({
                url: "/test_ajax",
                method: "GET",

                data: {
                    'base': $("#selected_base").text(),
                    'style': $("#style_no").text(),
                },
                dataType: "json",

            }).done(function (data) {

                console.log(data);
                $('#base_area').attr('src', data.out);

                // プロジェクト保存用
                $('#base').html(data.base);
                $('#style').html(data.style);
                $('#out').html(data.out);

                document.fm_name.styleimagepath.value = document.getElementById("style").textContent;
                document.fm_name.baseimagepath.value = document.getElementById("base").textContent;
                document.fm_name.outputimagepath.value = document.getElementById("out").textContent;


                //$('.modal').modal('hide');

            }).fail(function () {
                //$('.modal').modal('hide');
                console.log("error");
            });
        });

    });
</script>

{% endblock %}